<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitMap - Reset Password</title>
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <div class="reset-screen">
        <button class="back-button" onclick="goBack()">
            <img src="./Resources/Resource Icons/icons8-back-arrow-50.png" alt="back-arrow">
        </button>

        <div class="reset-password-header">
            <div class="logo-container">
                <div class="dumbbell-icon">
                    <img src="./Resources/Resource Images/53819-removebg-preview.png" alt="">
                </div>
            </div>
        </div>

        <div class="content-card">
            <h1 class="reset-title">Reset Your Password</h1>
            <p class="reset-description">
                Please enter your email address to get a password reset code
            </p>

            <form id="resetForm">
                <div class="form-group">
                    <label class="form-label" for="email">Enter Email</label>
                    <input 
                        type="email" 
                        id="email" 
                        class="form-input" 
                        placeholder="johnwick001@gmail.com"
                        required
                    >
                </div>

                <button type="submit" class="send-button" id="sendButton">
                    <div class="loading-spinner" id="loadingSpinner"></div>
                    <span id="buttonText">Send Code</span>
                </button>
            </form>

            <div class="success-message" id="successMessage" style="display: none;">
                A password reset code has been sent to your email address. Please check your inbox and follow the instructions.
            </div>

            <div class="error-message" id="errorMessage" style="display: none;">
                Unable to send reset code. Please check your email address and try again.
            </div>
        </div>
    </div>

    <script>
        function goBack() {
            window.location.href = './fit-map signin.html';
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function showLoading() {
            const button = document.getElementById('sendButton');
            const spinner = document.getElementById('loadingSpinner');
            const buttonText = document.getElementById('buttonText');
            
            button.disabled = true;
            button.style.opacity = '0.7';
            spinner.style.display = 'inline-block';
            buttonText.textContent = 'Sending...';
        }

        function hideLoading() {
            const button = document.getElementById('sendButton');
            const spinner = document.getElementById('loadingSpinner');
            const buttonText = document.getElementById('buttonText');
            
            button.disabled = false;
            button.style.opacity = '1';
            spinner.style.display = 'none';
            buttonText.textContent = 'Send Code';
        }

        function showMessage(type, customMessage = null) {
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            
            // Hide both messages first
            successMessage.style.display = 'none';
            errorMessage.style.display = 'none';
            
            if (type === 'success') {
                if (customMessage) {
                    successMessage.textContent = customMessage;
                }
                successMessage.style.display = 'block';
            } else if (type === 'error') {
                if (customMessage) {
                    errorMessage.textContent = customMessage;
                }
                errorMessage.style.display = 'block';
            }
        }

        function hideMessages() {
            document.getElementById('successMessage').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
        }

        document.getElementById('resetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const emailInput = document.getElementById('email');
            const email = emailInput.value.trim();
            
            // Hide any existing messages
            hideMessages();
            
            // Validate email
            if (!email) {
                showMessage('error', 'Please enter your email address.');
                return;
            }
            
            if (!validateEmail(email)) {
                showMessage('error', 'Please enter a valid email address.');
                return;
            }

            // Check if email exists in registered users
            const users = JSON.parse(localStorage.getItem('fitMapUsers') || '[]');
            const userExists = users.find(user => user.email === email);

            if (!userExists) {
                showMessage('error', 'No account found with this email address.');
                return;
            }
            
            // Show loading state
            showLoading();
            
            // Simulate sending email (2 second delay)
            setTimeout(() => {
                hideLoading();
                
                // Generate a 6-digit verification code
                const verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                
                // Store the code and email temporarily in localStorage
                localStorage.setItem('resetEmail', email);
                localStorage.setItem('resetCode', verificationCode);
                localStorage.setItem('resetCodeTimestamp', Date.now().toString());
                
                // Show success message
                showMessage('success', `A 6-digit verification code has been sent to ${email}. (Code: ${verificationCode} - For demo purposes)`);
                
                console.log('Verification code:', verificationCode);
                
                // Redirect to verification page after 3 seconds
                setTimeout(() => {
                    window.location.href = './fit-map code verification.html';
                }, 3000);
            }, 2000);
        });

        // Clear messages when user starts typing
        document.getElementById('email').addEventListener('input', function() {
            hideMessages();
        });

        // Add CSS for loading spinner
        const style = document.createElement('style');
        style.textContent = `
            .loading-spinner {
                display: none;
                width: 16px;
                height: 16px;
                border: 2px solid rgba(255,255,255,0.3);
                border-radius: 50%;
                border-top-color: white;
                animation: spin 0.8s linear infinite;
                margin-right: 8px;
            }

            @keyframes spin {
                to { transform: rotate(360deg); }
            }

            .success-message {
                background-color: #00C851;
                color: white;
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
                text-align: center;
            }

            .error-message {
                background-color: #ff4444;
                color: white;
                padding: 15px;
                border-radius: 8px;
                margin-top: 15px;
                text-align: center;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>